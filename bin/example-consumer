#!/usr/bin/env ruby

$LOAD_PATH.unshift File.expand_path(File.join(File.dirname(__FILE__), "../lib"))

require "pulsar/client"

client = Pulsar::Client.from_environment
consumer = client.subscribe('persistent://dnd/demigorgon/example-topic', 'example-consumer')
consumer.listen do |message, id, finish|
  puts "Received message '#{message}' [id: #{id}]"
  finish.call if message == "exit"
end
client.close
